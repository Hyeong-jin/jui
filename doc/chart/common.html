<!-- Create a simple CodeMirror instance -->
<link rel="stylesheet" href="../lib/codemirror-4.5/lib/codemirror.css">
<link rel="stylesheet" href="../lib/codemirror-4.5/theme/twilight.css">
<link rel="stylesheet" href="../lib/codemirror-4.5/theme/eclipse.css">
<link rel="stylesheet" href="../lib/codemirror-4.5/theme/neo.css">
<script src="../lib/codemirror-4.5/lib/codemirror.js"></script>
<script src="../lib/codemirror-4.5/mode/javascript/javascript.js"></script>

<style>
	.col {
		padding: 10px;
	}
	
	.panel .head {
		font-weight: bold;
	}
	
	.panel .body img {
		max-width: 100%;
	}
	
	.panel .body img:hover {
		border-radius: 5px;
		box-shadow: 2px 2px 5px #888888;
		cursor : pointer;
	}
	
	.CodeMirror {
	  font-size: 16px;
	  font-family : "Helvetica", "Trebuchet MS", Dotum, Verdana, AppleGothic, sans-serif;
	  height: 400px;
	}
	.CodeMirror-scroll {
	  overflow:auto;
	}
	
	.row.gallery { 
		margin-top: 30px;	
	}
</style>

<div class='row gallery'>
	
</div>

<script>
	var editor;
	var currentChartIndex  = 0;
	var charts = [
		{ type : 'bar', title : 'Bar Chart', start : 0 },
		{ type : 'column', title : 'Column Chart', start : 3 },
		{ type : 'pie', title : 'Pie Chart', start : 7},
		{ type : 'donut', title : 'Donut Chart', start : 8},
		{ type : 'scatter', title : 'Bubble & Scatter', start : 9},
		{ type : 'area', title : 'Area Chart', start : 14 },
		{ type : 'radar', title : 'Radar Chart', start : 20 },
		{ type : 'line', title : 'Line Chart', start : 22},
		{ type : 'gauge', title : 'Gauge Chart', start : 29},
		{ type : 'stock', title : 'Candle Stick Chart', start : 35},
	];
	
	var code_list = [
	
		// bar 
		{ title : "Bar Chart", description : "", code : "bar.js" },
		{ title : "Bar Chart", description : "", code : "stack_bar.js" },		
		{ title : "Bar Chart", description : "", code : "mini_bar.js" },
		
		// column 
		{ title : "Column Chart", description : "", code : "column.js" },		
		{ title : "Column Chart", description : "", code : "stack_column.js" },
		{ title : "Column Chart", description : "", code : "fullstack.js" },
		{ title : "Column Chart", description : "", code : "equalizer.js" },
								
		// pie 
		{ title : "Pie Chart", description : "", code : "pie.js" },
		
		// donut 
		{ title : "Donut Chart", description : "", code : "donut.js" },
				
		// scatter
		{ title : "Bubble Chart", description : "", code : "bubble.js" }, 
		{ title : "Bubble Chart", description : "", code : "range_bubble.js" },
		{ title : "Scatter Chart", description : "", code : "range_scatter.js" },
		{ title : "Scatter Chart", description : "", code : "scatter.js" },
		{ title : "Scatter Chart", description : "", code : "stack_scatter.js" },
		
		//area
		{ title : "Area Chart", description : "", code : "area.js" },
		{ title : "Area Chart", description : "", code : "curve_area.js" },		
		{ title : "Area Chart", description : "", code : "stack_area.js" },
		{ title : "Area Chart", description : "", code : "stack_curve_area.js" },		
		{ title : "Area Chart", description : "", code : "stack_step_area.js" },
		{ title : "Area Chart", description : "", code : "step_area.js" },		
		
		
		// radar
		{ title : "Radar Chart", description : "", code : "radar.js" },
		{ title : "Radar Chart", description : "", code : "circle_radar.js" },
				
		// line

		{ title : "Line Chart", description : "", code : "curve_line.js" },
		{ title : "Line Chart", description : "", code : "line.js" },
		{ title : "Line Chart", description : "", code : "line2.js" },
		{ title : "Line Chart", description : "", code : "mini_line.js" },
		{ title : "Line Chart", description : "", code : "range_line.js" },
		{ title : "Line Chart", description : "", code : "stack_line.js" },
		{ title : "Line Chart", description : "", code : "step_line.js" },
		
		// gauge 
		
		
		{ title : "Gauge Chart", description : "", code : "circle_gauge.js" },
		{ title : "Gauge Chart", description : "", code : "fill_custom_gauge.js" },
		{ title : "Gauge Chart", description : "", code : "fill_gauge.js" },
		{ title : "Gauge Chart", description : "", code : "full_gauge.js" },
		{ title : "Gauge Chart", description : "", code : "gauge.js" },
		{ title : "Gauge Chart", description : "", code : "stack_gauge.js" },

		// candle stick 
		{ title : "CandleStick Chart", description : "", code : "candlestick.js" },
	];
	
	function createTable () {
	    var chart = window.currentChart;
	    var data = chart.data();
	    var obj = data[0];
	    
	    var fields = [];
	    for(var key in obj) {
	        if (typeof obj[key] == 'function') continue;
	        fields.push(key);
	    }
	    
	    window.fields = fields; 
	    
	    var $head = $('#table_1 thead tr');
	    // create thead
	    $head.empty();

	    for(var i = 0; i < fields.length; i++) {
	        $head.append("<th>" + fields[i] + "</th>");
	    }
	    
	    // create template 
	    var list = [];
        for(var i = 0; i < fields.length; i++) {
            list.push("<td><!= " + fields[i] + " !></td>");
        }
	    
	    var tpl = ["<tr>", list.join("") ,"</tr>"].join("")
	    
	    table_1.setTpl('row', tpl);
	    table_1.options.data = data;
	    table_1.options.editRow = true; 
	    table_1.options.fields = window.fields;
	    
	    table_1.init();
	    
	    
	    window.currentChart.bind(table_1);
	    
	    var enableAddRow = code_list[currentChartIndex].add || false ;
	    if (enableAddRow) {
	        $(".add-row-btn").show();
	    } else {
	        $(".add-row-btn").hide();
	    }
	    
	}
	
	function addRow() {
	    
	    var obj = code_list[currentChartIndex].obj;
	    
	    table_1.append(obj)
	    
	}
	
	function nextChart() {
		currentChartIndex = (++currentChartIndex) % code_list.length;
		viewCodeEditor(); 
	}
	
	function prevChart() {
		--currentChartIndex;
		
		if (currentChartIndex < 0) {
			currentChartIndex = code_list.length - 1; 
		}
		
		viewCodeEditor(); 
	}
	
	function viewCodeEditor() {
		var code = code_list[currentChartIndex];
		
		$("#modal_1").find(".title").html([code.title, "(", code.code ,")"].join(""))
		
		$("#modal_1").width(1024).height(500);
		
		modal_1.show();

	  if (!editor) {
		  editor = CodeMirror.fromTextArea($("#chart-code-text")[0], {
		    mode: "javascript",
		    lineNumbers: true,
		    styleActiveLine: true,
		    matchBrackets: true,
		    theme : 'neo'
		  });
		  
		  editor.on('change', function(cm, change) {
		  	try {
		  		$("#chart-content").empty();
		  		$.globalEval(cm.getValue());	
		  		
		  		var chart = jui.get('chart.basic').pop();
		  		
		  		window.currentChart = chart.list[chart.list.length -1];
		  		
		  	} catch(e) {
		  		console.log(e);
		  	}
		  	
		  })
	  }

		$.ajax({ 
			url : 'chart/json/' + code.code,
			dataType : 'text',
			success : function (data) {
				
				if (data.indexOf("#chart-content") > -1) {
					editor.setValue(data);
				} else if (data.indexOf("#chart") > -1) {
					editor.setValue(data.replace("#chart", "#chart-content"));	
				}
			},
			error : function(data, error) {
				console.log(error);
			}
		})
		
	}
	
	$(function() {
		var $row = $(".row.gallery");
		var $dom = $("#tpl_col").html();
		for(var i = 0, len = charts.length; i <len; i++ ) {
			var $el = $($dom);
			var chart = charts[i];
			
			$el.find(".head").html(chart.title);
			$el.find(".body img").attr({
				'src' : 'chart/img/' + chart.type + '.svg',
			}).data('obj', chart).on('click', function(e) {
				var obj = $(this).data('obj');
				currentChartIndex = obj.start; 
				viewCodeEditor();				
			});
			
			$row.append($el);
		}
		
		editor = null;
	})
	
	jui.ready(function(ui, uix, _) {
		
		modal_1 = ui.modal("#modal_1", {
			color: "black"
		});
		
		tab_1 = uix.tab("#tab_1", {
			event: {
				change: function(data) {
					
					if (data.index == 1) {
					    createTable();
					}
				}
			},
			target: "#tab_contents_1",
			index: 0
		});
		 
		table_1 = uix.table("#table_1", {
		    fields : []
		})
		
	})
</script>

<script type="text/template" id="tpl_col">
	<div class='col col-3'>
		<div class='panel'>
			<div class='head'></div>
			<div class='body'>
				<img src="" />
			</div>
		</div>
	</div>	
</script>

<script data-jui="#table_1" data-tpl="row" type="text/template">

</script>


<div id="modal_1" class="msgbox msgbox-white" style="display:none;">
	<div class="head" style="overflow:auto">
		<h2 class='title'></h2>
		<span style='float:right'>
			<a class='btn btn-gray btn-flat btn-rect' href="javascript:void(prevChart())"><i class='icon-chevron-left'></i></a>
			<a class='btn btn-gray btn-flat btn-rect' href="javascript:void(nextChart())"><i class='icon-chevron-right'></i></a>
		</span>
    </div>
	<div class="body" style="padding:0px !important;">
		<div class='row'>
			<div class='col col-5'>
				<div style="border:1px solid white;height:100%;width:100%;background:white;text-align:center;overflow: scroll;">
					<div id="chart-content"></div>
				</div>
			</div>
			<div class='col col-7' style='border-left:1px solid #ebebeb'>
				
				<ul id="tab_1" class="tab tab-top" style='margin-top:0px;'>
					<li>
						<a href="#chart-code">Code</a>
					</li>
					<li>
						<a href="#chart-data">Data</a>
					</li>
				</ul>
				
				<div id="tab_contents_1" class="tab-contents" style="background: #dcdcdc;">
					<div id="chart-code">
						<textarea id="chart-code-text">test</textarea>
					</div>
					<div id="chart-data">
						
						<div class="panel" style="height:400px;">
							<div class="head">
								<strong>Data Binding</strong>
								<div style="float:right">
									<a class='btn btn-gray btn-flat btn-rect btn-small add-row-btn' href="javascript:void(addRow())">추가</a>	
								</div>
								
							</div>
							<table id="table_1" class="table table-classic table-hover" style="width: 100%;">
								<thead>
									<tr>
										<td>name</td>
										<td>value</td>
									</tr>
								</thead>
								<tbody>
									
								</tbody>
							</table>

						</div>
					</div>					
				</div>
			</div>
		</div>
	</div>
</div>	
	

