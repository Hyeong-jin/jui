<!DOCTYPE html>
<html>
<head>
    <meta chartset="utf-8" />
    <link rel="stylesheet" href="../../jui.css" />
    <link rel="stylesheet" href="../../lib/animate.min.css" />
    <script src="../../lib/jquery-1.8.3.min.js"></script>
    <script src="../../jui.js"></script>
</head>
<body class="jui">

<input type="file" id="xtable_btn" style="margin-bottom: 7px;"><br/>

<div class="row" style="margin-bottom: 14px;">
    <table id="xtable" class="table table-classic">
        <thead>
        <tr>
            <th>Date</th>
            <th>Open</th>
            <th>High</th>
            <th>Low</th>
            <th>Close</th>
            <th>Volume</th>
            <th>Adj Close</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="row">
    <div id="chart"></div>
</div>

<script data-jui="#xtable" data-tpl="row" type="text/template">
    <tr>
        <td><!= date !></td>
        <td><!= open !></td>
        <td><!= high !></td>
        <td><!= low !></td>
        <td><!= close !></td>
        <td><!= volume !></td>
        <td><!= adj_close !></td>
    </tr>
</script>

<script>
    jui.ready([ "chart.basic", "uix.xtable", "util.time" ], function(chart, table, time) {
        var xtable = table("#xtable", {
            fields: [ "date", "open", "high", "low", "close", "volume", "adj_close" ],
            sort: true,
            resize: true,
            animate: true
        });

        $("#xtable_btn").change(function(e) {
            xtable.setCsvFile(e.target.files[0]);
        });

        chart("#chart", {
            width: 1200,
            height : 400,
            theme : location.href.split("?")[1].split("=")[1],
            grid : {
                x : {
                    type : "block",  // default type is block
                    target : 'date',
                    format: function(d) {
                        return time.format(new Date(d.date), "MM-dd");
                    },
                    line: true
                },
                y : {
                    type : 'range',
                    target: [ "open", "high", "low", "close" ],
                    step: 5,
                    line : true
                }
            },
            series : {
                low: {
                    type: "low"
                },
                high: {
                    type: "high"
                },
                open: {
                    type: "open"
                },
                close: {
                    type: "close"
                }
            },
            brush : {
                type : 'candlestick'
            },
            bind: xtable
        });
	});
</script>


</body>
</html>